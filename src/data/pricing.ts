export type CustomerType = 'عادي' | 'المدينة' | 'مسوق' | 'شركات';
export type LevelType = 'A' | 'B' | string;
export type PricingRow = {
  idx: number;
  المقاس: string;
  المستوى: LevelType;
  الزبون: CustomerType;
  'شهر واحد': number | string | null;
  '2 أشهر': number | string | null;
  '3 أشهر': number | string | null;
  '6 أشهر': number | string | null;
  'سنة كاملة': number | string | null;
  'يوم واحد': number | string | null;
  id: number;
};

export const PRICING: PricingRow[] = [
  {"idx":0,"المقاس":"13x5","المستوى":"A","الزبون":"عادي","شهر واحد":"0","2 أشهر":24000,"3 أشهر":28800,"6 أشهر":36800,"سنة كاملة":58000,"يوم واحد":10,"id":1},
  {"idx":1,"المقاس":"13x5","المستوى":"A","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":69000,"يوم واحد":10,"id":2},
  {"idx":2,"المقاس":"13x5","المستوى":"A","الزبون":"مسوق","شهر واحد":"0","2 أشهر":21600,"3 أشهر":25920,"6 أشهر":33000,"سنة كاملة":52200,"يوم واحد":10,"id":3},
  {"idx":3,"المقاس":"13x5","المستوى":"A","الزبون":"شركات","شهر واحد":"0","2 أشهر":24000,"3 أشهر":29000,"6 أشهر":39000,"سنة كاملة":600,"يوم واحد":2000,"id":4},
  {"idx":4,"المقاس":"12x4","المستوى":"A","الزبون":"عادي","شهر واحد":"0","2 أشهر":21100,"3 أشهر":25000,"6 أشهر":35000,"سنة كاملة":55000,"يوم واحد":10,"id":5},
  {"idx":5,"المقاس":"12x4","المستوى":"A","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":55000,"يوم واحد":10,"id":6},
  {"idx":6,"المقاس":"12x4","المستوى":"A","الزبون":"مسوق","شهر واحد":"0","2 أشهر":19000,"3 أشهر":22500,"6 أشهر":31500,"سنة كاملة":50000,"يوم واحد":10,"id":7},
  {"idx":7,"المقاس":"12x4","المستوى":"A","الزبون":"شركات","شهر واحد":"0","2 أشهر":21000,"3 أشهر":27000,"6 أشهر":37000,"سنة كاملة":64000,"يوم واحد":10,"id":8},
  {"idx":8,"المقاس":"12x4","المستوى":"B","الزبون":"عادي","شهر واحد":"0","2 أشهر":21100,"3 أشهر":22500,"6 أشهر":27800,"سنة كاملة":44500,"يوم واحد":10,"id":9},
  {"idx":9,"المقاس":"12x4","المستوى":"B","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":55000,"يوم واحد":10,"id":10},
  {"idx":10,"المقاس":"12x4","المستوى":"B","الزبون":"مسوق","شهر واحد":"0","2 أشهر":19000,"3 أشهر":20250,"6 أشهر":25000,"سنة كاملة":40000,"يوم واحد":10,"id":11},
  {"idx":11,"المقاس":"12x4","المستوى":"B","الزبون":"شركات","شهر واحد":"0","2 أشهر":21000,"3 أشهر":27000,"6 أشهر":37000,"سنة كاملة":64000,"يوم واحد":10,"id":12},
  {"idx":12,"المقاس":"10x4","المستوى":"A","الزبون":"عادي","شهر واحد":"0","2 أشهر":17500,"3 أشهر":19000,"6 أشهر":29000,"سنة كاملة":49000,"يوم واحد":10,"id":13},
  {"idx":13,"المقاس":"10x4","المستوى":"A","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":50000,"يوم واحد":10,"id":14},
  {"idx":14,"المقاس":"10x4","المستوى":"A","الزبون":"مسوق","شهر واحد":"0","2 أشهر":15800,"3 أشهر":17100,"6 أشهر":26000,"سنة كاملة":44000,"يوم واحد":10,"id":15},
  {"idx":15,"المقاس":"10x4","المستوى":"A","الزبون":"شركات","شهر واحد":"0","2 أشهر":19000,"3 أشهر":24000,"6 أشهر":34000,"سنة كاملة":54000,"يوم واحد":10,"id":16},
  {"idx":16,"المقاس":"10x4","المستوى":"B","الزبون":"عادي","شهر واحد":"0","2 أشهر":15900,"3 أشهر":16700,"6 أشهر":24500,"سنة كاملة":42500,"يوم واحد":10,"id":17},
  {"idx":17,"المقاس":"10x4","المستوى":"B","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":50000,"يوم واحد":10,"id":18},
  {"idx":18,"المقاس":"10x4","المستوى":"B","الزبون":"مسوق","شهر واحد":"0","2 أشهر":14300,"3 أشهر":15000,"6 أشهر":22000,"سنة كاملة":38200,"يوم واحد":10,"id":19},
  {"idx":19,"المقاس":"10x4","المستوى":"B","الزبون":"شركات","شهر واحد":"0","2 أشهر":19000,"3 أشهر":24000,"6 أشهر":34000,"سنة كاملة":54000,"يوم واحد":10,"id":20},
  {"idx":20,"المقاس":"8x3","المستوى":"A","الزبون":"عادي","شهر واحد":"0","2 أشهر":4400,"3 أشهر":5400,"6 أشهر":8400,"سنة كاملة":15400,"يوم واحد":10,"id":21},
  {"idx":21,"المقاس":"8x3","المستوى":"A","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":16000,"يوم واحد":10,"id":22},
  {"idx":22,"المقاس":"8x3","المستوى":"A","الزبون":"مسوق","شهر واحد":"0","2 أشهر":4000,"3 أشهر":4900,"6 أشهر":7500,"سنة كاملة":13900,"يوم واحد":10,"id":23},
  {"idx":23,"المقاس":"8x3","المستوى":"A","الزبون":"شركات","شهر واحد":"0","2 أشهر":5500,"3 أشهر":7500,"6 أشهر":11500,"سنة كاملة":19500,"يوم واحد":10,"id":24},
  {"idx":24,"المقاس":"8x3","المستوى":"B","الزبون":"عادي","شهر واحد":"0","2 أشهر":3900,"3 أشهر":4450,"6 أشهر":6700,"سنة كاملة":11150,"يوم واحد":10,"id":25},
  {"idx":25,"المقاس":"8x3","المستوى":"B","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":16000,"يوم واحد":10,"id":26},
  {"idx":26,"المقاس":"8x3","المستوى":"B","الزبون":"مسوق","شهر واحد":"0","2 أشهر":3500,"3 أشهر":4000,"6 أشهر":6000,"سنة كاملة":10000,"يوم واحد":10,"id":27},
  {"idx":27,"المقاس":"8x3","المستوى":"B","الزبون":"شركات","شهر واحد":"0","2 أشهر":5500,"3 أشهر":7500,"6 أشهر":11500,"سنة كاملة":19500,"يوم واحد":10,"id":28},
  {"idx":28,"المقاس":"6x3","المستوى":"A","الزبون":"عادي","شهر واحد":"0","2 أشهر":3500,"3 أشهر":4500,"6 أشهر":7500,"سنة كاملة":14500,"يوم واحد":10,"id":29},
  {"idx":29,"المقاس":"6x3","المستوى":"A","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":14000,"يوم واحد":10,"id":30},
  {"idx":30,"المقاس":"6x3","المستوى":"A","الزبون":"مسوق","شهر واحد":"0","2 أشهر":3200,"3 أشهر":4000,"6 أشهر":6800,"سنة كاملة":13000,"يوم واحد":10,"id":31},
  {"idx":31,"المقاس":"6x3","المستوى":"A","الزبون":"شركات","شهر واحد":"0","2 أشهر":4500,"3 أشهر":6500,"6 أشهر":9500,"سنة كاملة":17500,"يوم واحد":10,"id":32},
  {"idx":32,"المقاس":"6x3","المستوى":"B","الزبون":"عادي","شهر واحد":"0","2 أشهر":2900,"3 أشهر":3550,"6 أشهر":5600,"سنة كاملة":10000,"يوم واحد":10,"id":33},
  {"idx":33,"المقاس":"6x3","المستوى":"B","الزبون":"مسوق","شهر واحد":"0","2 أشهر":3960,"3 أشهر":3200,"6 أشهر":5000,"سنة كاملة":9000,"يوم واحد":10,"id":34},
  {"idx":34,"المقاس":"6x3","المستوى":"B","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":14000,"يوم واحد":10,"id":35},
  {"idx":35,"المقاس":"6x3","المستوى":"B","الزبون":"شركات","شهر واحد":"0","2 أشهر":4500,"3 أشهر":6500,"6 أشهر":9500,"سنة كاملة":17500,"يوم واحد":10,"id":36},
  {"idx":36,"المقاس":"4x3","المستوى":"A","الزبون":"عادي","شهر واحد":"1700","2 أشهر":0,"3 أشهر":3200,"6 أشهر":5700,"سنة كاملة":8700,"يوم واحد":10,"id":37},
  {"idx":37,"المقاس":"4x3","المستوى":"A","الزبون":"مسوق","شهر واحد":"1530","2 أشهر":3150,"3 أشهر":2900,"6 أشهر":5100,"سنة كاملة":7900,"يوم واحد":10,"id":38},
  {"idx":38,"المقاس":"4x3","المستوى":"A","الزبون":"شركات","شهر واحد":"1700","2 أشهر":0,"3 أشهر":3300,"6 أشهر":5700,"سنة كاملة":8700,"يوم واحد":10,"id":39},
  {"idx":39,"المقاس":"4x3","المستوى":"A","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":9000,"يوم واحد":10,"id":40},
  {"idx":40,"المقاس":"4x3","المستوى":"B","الزبون":"شركات","شهر واحد":"1700","2 أشهر":0,"3 أشهر":3300,"6 أشهر":5700,"سنة كاملة":8700,"يوم واحد":10,"id":41},
  {"idx":41,"المقاس":"4x3","المستوى":"B","الزبون":"المدينة","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":9000,"يوم واحد":10,"id":42},
  {"idx":42,"المقاس":"4x3","المستوى":"B","الزبون":"عادي","شهر واحد":"1000","2 أشهر":0,"3 أشهر":2250,"6 أشهر":3350,"سنة كاملة":5600,"يوم واحد":10,"id":43},
  {"idx":43,"المقاس":"4x3","المستوى":"B","الزبون":"مسوق","شهر واحد":"0","2 أشهر":0,"3 أشهر":0,"6 أشهر":0,"سنة كاملة":8100,"يوم واحد":10,"id":44},
  {"idx":44,"المقاس":"3x6","المستوى":"A","الزبون":"شركات","شهر واحد":null,"2 أشهر":null,"3 أشهر":null,"6 أشهر":null,"سنة كاملة":null,"يوم واحد":200,"id":46},
  {"idx":45,"المقاس":"4x3","المستوى":"A","الزبون":"شركات","شهر واحد":null,"2 أشهر":null,"3 أشهر":null,"6 أشهر":null,"سنة كاملة":900,"يوم واحد":null,"id":47},
  {"idx":46,"المقاس":"4x3","المستوى":"A","الزبون":"شركات","شهر واحد":null,"2 أشهر":null,"3 أشهر":null,"6 أشهر":null,"سنة كاملة":200,"يوم واحد":null,"id":48},
  {"idx":47,"المقاس":"4x3","المستوى":"A","الزبون":"شركات","شهر واحد":null,"2 أشهر":null,"3 أشهر":null,"6 أشهر":null,"سنة كاملة":200,"يوم واحد":null,"id":49}
];

const monthKey = (months: number): keyof PricingRow => {
  switch (months) {
    case 1: return 'شهر واحد';
    case 2: return '2 أشهر';
    case 3: return '3 أشهر';
    case 6: return '6 أشهر';
    case 12: return 'سنة كاملة';
    default: return 'شهر واحد';
  }
};

export const CUSTOMERS: CustomerType[] = Array.from(new Set(PRICING.map(p => p['الزبون'] as CustomerType))) as CustomerType[];

function canonSize(size: string): string {
  if (!size) return '4x12';
  let s = String(size).toLowerCase().replace(/[×xX]/g, 'x').replace(/[^\dx]/g, '');
  const parts = s.split('x').map(Number).filter(n => !isNaN(n));
  if (parts.length === 2) {
    parts.sort((a,b)=>a-b);
    return parts.join('x');
  }
  return s;
}

function normalizeNumber(v: any): number | null {
  if (v === null || v === undefined) return null;
  if (typeof v === 'number') return isNaN(v) ? null : v;
  const n = Number(String(v).replace(/[^\d.-]/g, ''));
  return isNaN(n) ? null : n;
}

export function getPriceFor(size: string, level: LevelType | undefined, customer: CustomerType, months: number): number | null {
  const key = monthKey(months);
  const cs = canonSize(size);
  const lvl = level || 'A';
  // exact match
  let row = PRICING.find(r => canonSize(r['المقاس']) === cs && r['المستوى'] === lvl && r['الزبون'] === customer);
  // fallback 1: ignore level
  if (!row) row = PRICING.find(r => canonSize(r['المقاس']) === cs && r['الزبون'] === customer);
  // fallback 2: any row with same size
  if (!row) row = PRICING.find(r => canonSize(r['المقاس']) === cs);
  if (!row) return null;
  return normalizeNumber((row as any)[key]);
}